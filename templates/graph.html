<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Graph</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <style>
        .graph{
            display: flex;
            align-items: center;
            height: 50vh;
        }
        .centre{
            margin-left: 850px;
        }
        .mt{
            margin-top: 25px;
        }
        </style>
</head>
<body>
    <div class="graph">
    <img src="{{ url_for('static', filename='images/graph.png') }}" alt="Graph Image"  >
</div>
<div class="centre">
<button type="button" id="stimulateButton" onclick="stimulate()" class="btn btn-outline-primary">Stimulation</button>
</div>

<div class="card-group mt">
    <div class="card" id="stationA">
      <div class="card-body">
        <h5 class="card-title">Station A</h5>
        <p class="card-text" >This is a wider card with supporting text below as a natural lead-in to additional content. This content is a little bit longer.</p>
        <p class="card-text"><small class="text-muted">Last updated 3 mins ago</small></p>

      </div>
    </div>
    <div class="card" id="stationBC">
      <div class="card-body">
        <h5 class="card-title">Station B</h5>
        <p class="card-text">This card has supporting text below as a natural lead-in to additional content.</p>
        <p class="card-text"><small class="text-muted">Last updated 3 mins ago</small></p>

      </div>
    </div>
    <div class="card" id="stationC">
      <div class="card-body">
        <h5 class="card-title">Station C</h5>
        <p class="card-text">This is a wider card with supporting text below as a natural lead-in to additional content. This card has even longer content than the first to show that equal height action.</p>
        <p class="card-text"><small class="text-muted">Last updated 3 mins ago</small></p>

      </div>
    </div>
    <div class="card" id="stationD">
        <div class="card-body">
          <h5 class="card-title">Station D</h5>
          <p class="card-text">This is a wider card with supporting text below as a natural lead-in to additional content. This card has even longer content than the first to show that equal height action.</p>
          <p class="card-text"><small class="text-muted">Last updated 3 mins ago</small></p>

        </div>
      </div>
      <div class="card" id="stationBD">
        <div class="card-body">
          <h5 class="card-title">Station E</h5>
          <p class="card-text">This is a wider card with supporting text below as a natural lead-in to additional content. This card has even longer content than the first to show that equal height action.</p>
          <p class="card-text"><small class="text-muted">Last updated 3 mins ago</small></p>

        </div>
      </div>
  </div>

  <div class="logs">
    <p class="card-text.messages"></p>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.0.3/socket.io.js"></script>
  <script>
    function stimulate() {
        // Disable the button
        document.getElementById("stimulateButton").disabled = true;
        
        // Make a GET request to a website (replace 'your_website_url' with the actual URL)
        $.ajax({
            type: "GET",
            url: "http://192.168.29.105:3000",
            success: function(response) {
                console.log("GET request successful");
            },
            error: function(error) {
                console.error("Error in GET request", error);
            },
            complete: function() {
                // Enable the button after 70 seconds
                setTimeout(function() {
                    document.getElementById("stimulateButton").disabled = false;
                }, 70000); // 70 seconds
            }
        });
    }

    var socket = io.connect('http://' + document.domain + ':' + location.port);

    // Handle updates from the server
    socket.on('ml_process_update', function(data) {
        updateCard(data.station, data.messages);
    });

    // Function to update the card content
    function updateCard(station, messages) {
        const card = document.getElementById(`station${station}`);
        const lastUpdated = new Date().toLocaleTimeString();
        card.querySelector(".card-text").textContent = `Messages: ${JSON.stringify(messages)}`;
        card.querySelector(".text-muted").textContent = `Last updated: ${lastUpdated}`;

        const messagesContainer = card.querySelector(".card-text.messages");
        const distMessage = messages['dist'] !== undefined ? `Distance: ${messages['dist']}` : '';
        
        // Display 'fault' value
        const faultMessage = messages['fault'] !== undefined ? `Fault: ${messages['fault']}` : '';

        // Append new messages to the existing content
        const existingContent = messagesContainer.innerHTML;
        const newContent = `${existingContent}<br>${distMessage} ${faultMessage}`;

        // Update messagesContainer with the combined content
        messagesContainer.innerHTML = newContent;
    }
</script>

</body>
</html>
